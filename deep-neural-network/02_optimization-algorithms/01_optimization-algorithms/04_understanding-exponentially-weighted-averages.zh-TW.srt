1
00:00:00,000 --> 00:00:03,900
在上一部影片，我們談到了指數加權平均

2
00:00:03,900 --> 00:00:06,345
它其實很關鍵

3
00:00:06,345 --> 00:00:09,910
在一些訓練神經網路的最佳化演算法當中。

4
00:00:09,910 --> 00:00:12,330
所以在這部影片，我想深入探討

5
00:00:12,330 --> 00:00:15,930
這方法的道理及背後所做之事。

6
00:00:15,930 --> 00:00:21,305
回想一下，這是實作指數加權平均的主要公式

7
00:00:21,305 --> 00:00:24,755
如果 beta = 0.9，你會得到這條紅線

8
00:00:24,755 --> 00:00:26,390
如果很靠近 1

9
00:00:26,390 --> 00:00:29,700
如果 beta 是 0.98，你就有這條綠色的

10
00:00:29,700 --> 00:00:31,200
而比較小的話

11
00:00:31,200 --> 00:00:34,470
例如 0.5，你得到這條黃線

12
00:00:34,470 --> 00:00:37,110
讓我們做更多觀察，來了解

13
00:00:37,110 --> 00:00:40,220
這是怎麼算出每日氣溫的平均。

14
00:00:40,220 --> 00:00:41,935
又看到這公式啦

15
00:00:41,935 --> 00:00:48,330
這次我們假設 beta 為 0.9，然後列出一些這公式的式子

16
00:00:48,330 --> 00:00:50,970
雖然實作的時候，你的 t

17
00:00:50,970 --> 00:00:54,105
是從零到一、二、三 ...

18
00:00:54,105 --> 00:00:56,760
t 是往上增加。但是分析的時候

19
00:00:56,760 --> 00:01:00,740
我讓 t 遞減、寫下來，依此類推。

20
00:01:00,740 --> 00:01:03,055
那麼我們拿第一個式子

21
00:01:03,055 --> 00:01:06,750
了解 V_100 到底是什麼

22
00:01:06,750 --> 00:01:09,795
所以 V_100 會是

23
00:01:09,795 --> 00:01:11,850
讓我把這兩項交換

24
00:01:11,850 --> 00:01:15,195
會是 0.1 乘 theta_100

25
00:01:15,195 --> 00:01:19,620
加上 0.9 乘上前一天算出的值

26
00:01:19,620 --> 00:01:21,055
可是，V_99 又是什麼呢？

27
00:01:21,055 --> 00:01:25,075
我們就把這個式子代進去

28
00:01:25,075 --> 00:01:30,390
所以這個會是 0.1 乘 theta_99

29
00:01:30,390 --> 00:01:33,215
— 我一樣把這兩項交換 —

30
00:01:33,215 --> 00:01:38,030
加上 0.9 乘以 V_98。

31
00:01:38,030 --> 00:01:39,485
那 V_98 又是什麼？

32
00:01:39,485 --> 00:01:41,765
你看，他在這邊

33
00:01:41,765 --> 00:01:44,220
所以你可以代入這邊

34
00:01:44,220 --> 00:01:47,875
0.1 乘 theta_98

35
00:01:47,875 --> 00:01:52,560
加上 0.9 乘 V_97，依此類推。

36
00:01:52,560 --> 00:01:54,405
如果你把全部的項乘開

37
00:01:54,405 --> 00:02:00,060
你可以得到 V_100 是 0.1 乘以 theta_100、加上

38
00:02:00,060 --> 00:02:02,552
我們來看看 theta_99 的係數

39
00:02:02,552 --> 00:02:09,030
他會是 0.1 乘 0.9 乘以 theta_99

40
00:02:09,030 --> 00:02:12,160
然後來看看 theta_98 的係數

41
00:02:12,160 --> 00:02:16,880
這邊有個 0.1、然後乘 0.9 再乘 0.9

42
00:02:16,880 --> 00:02:18,565
所以把運算展開

43
00:02:18,565 --> 00:02:26,295
這個會是 0.1 乘以 0.9的平方，乘上 theta_98。

44
00:02:26,295 --> 00:02:28,260
如果你持續展開下去

45
00:02:28,260 --> 00:02:32,315
你發現這變成 0.1 乘 0.9的三次方

46
00:02:32,315 --> 00:02:34,920
theta_97，加上 0.1

47
00:02:34,920 --> 00:02:37,440
乘 0.9 的四次方

48
00:02:37,440 --> 00:02:41,800
乘以 theta_96 ...。

49
00:02:41,800 --> 00:02:47,010
那麼，這其實是一個經過加權的總和，
也就是加權平均，對於 theta_100 —

50
00:02:47,010 --> 00:02:49,680
theta_100 是當天的氣溫，如果你從

51
00:02:49,680 --> 00:02:53,730
想算出第一百天，也就是 V_100 的角度來看 —

52
00:02:53,730 --> 00:02:56,870
所以是 theta_100

53
00:02:56,870 --> 00:02:58,865
theta_99, theta_98,

54
00:02:58,865 --> 00:03:02,175
theta_97, theta_96... 等等的加權總和。

55
00:03:02,175 --> 00:03:05,250
如果要用畫的來表示，可以這樣

56
00:03:05,250 --> 00:03:08,880
假設我們有某些日子的溫度

57
00:03:08,880 --> 00:03:14,610
這邊是 theta、這邊是 t；theta_100 是某個值

58
00:03:14,610 --> 00:03:17,095
然後 theta_99 是某個值

59
00:03:17,095 --> 00:03:19,360
theta_98

60
00:03:19,360 --> 00:03:21,255
所以這是 t=100

61
00:03:21,255 --> 00:03:23,070
99, 98, 等等等

62
00:03:23,070 --> 00:03:26,360
所以你有一些日子的氣溫

63
00:03:26,360 --> 00:03:31,015
那麼我們有的，是一個呈指數衰減的函數

64
00:03:31,015 --> 00:03:37,140
從 0.1 開始

65
00:03:37,140 --> 00:03:41,630
到 0.9 乘以 0.1

66
00:03:41,630 --> 00:03:44,555
到 0.9 平方乘以 0.1，依此類推

67
00:03:44,555 --> 00:03:47,150
所以你有這個指數衰減的函數

68
00:03:47,150 --> 00:03:50,600
那你要算 V_100 的方法

69
00:03:50,600 --> 00:03:55,760
就是把這兩個函數之間相對應的元素乘起來，再加總

70
00:03:55,760 --> 00:03:56,985
所以拿這個值

71
00:03:56,985 --> 00:03:59,165
theta_100 乘以 0.1

72
00:03:59,165 --> 00:04:05,770
然後這個值 theta_99，乘以0.1乘0.9

73
00:04:05,770 --> 00:04:07,995
也就是第二項，以此類推

74
00:04:07,995 --> 00:04:10,170
其實就是拿這個每日溫度

75
00:04:10,170 --> 00:04:14,610
乘以這個指數衰減函數，然後加總起來

76
00:04:14,610 --> 00:04:17,390
這就會是你的 V_100

77
00:04:17,390 --> 00:04:19,165
實際上

78
00:04:19,165 --> 00:04:21,090
我們後面會講到細節

79
00:04:21,090 --> 00:04:22,655
這邊所有的係數

80
00:04:22,655 --> 00:04:27,335
加起來會是 1，或說是非常靠近 1

81
00:04:27,335 --> 00:04:31,670
在下部影片我們會談到這個偏差矯正的細節

82
00:04:31,670 --> 00:04:35,225
不過總之因為這樣，這的確是這指數加權的平均。

83
00:04:35,225 --> 00:04:37,595
最後呢，你可能有疑問

84
00:04:37,595 --> 00:04:41,210
這究竟是對多少天的氣溫做平均

85
00:04:41,210 --> 00:04:46,400
那麼其實，0.9的10次方

86
00:04:46,400 --> 00:04:52,085
大概是 0.35，也就是 e 分之 1，

87
00:04:52,085 --> 00:04:54,410
1 除以自然對數的底

88
00:04:54,410 --> 00:04:59,030
更一般地說，如果你有 1 - epsilon

89
00:04:59,030 --> 00:05:00,200
— 在這例子

90
00:05:00,200 --> 00:05:01,880
epsilon 會是 0.1

91
00:05:01,880 --> 00:05:07,250
所以這是0.9 — 那麼 (1-epsilon) 的 epsilon分之一次方

92
00:05:07,250 --> 00:05:08,720
這大約會是 e分之一

93
00:05:08,720 --> 00:05:12,065
大約是 0.34, 0.35

94
00:05:12,065 --> 00:05:14,735
換句話說

95
00:05:14,735 --> 00:05:19,610
大概要過10天，這個的高度

96
00:05:19,610 --> 00:05:24,680
會衰減至約 1/3，其實是 1/e

97
00:05:24,680 --> 00:05:25,915
因為這樣

98
00:05:25,915 --> 00:05:31,325
我們會說當 beta=0.9 時

99
00:05:31,325 --> 00:05:35,090
這如同於你在計算

100
00:05:35,090 --> 00:05:40,355
專注在最後 10 天氣溫的指數加權平均

101
00:05:40,355 --> 00:05:43,940
因為在 10 天之後，這邊的加權衰減至

102
00:05:43,940 --> 00:05:48,380
比當天的加權的三分之一還少。

103
00:05:48,380 --> 00:05:53,300
相對地，如果 beta 是 0.98

104
00:05:53,300 --> 00:05:59,320
那麼 0.98 的多少次方會變得那樣子小呢？

105
00:05:59,320 --> 00:06:04,310
原來 0.98 的 50 次方大約會等於

106
00:06:04,310 --> 00:06:06,710
e分之一。所以其權重

107
00:06:06,710 --> 00:06:09,380
在前五十天會很大，比 1/e 還大，

108
00:06:09,380 --> 00:06:11,840
然後會快速地衰減

109
00:06:11,840 --> 00:06:14,780
所以概念上是這樣的

110
00:06:14,780 --> 00:06:18,860
你可以把這看成是以50天的氣溫做平均

111
00:06:18,860 --> 00:06:20,335
因為在這個例子

112
00:06:20,335 --> 00:06:22,290
看左邊這一項

113
00:06:22,290 --> 00:06:25,530
如同 epsilon=0.02

114
00:06:25,530 --> 00:06:27,750
所以 1/epsilon 是 50

115
00:06:27,750 --> 00:06:30,080
題外話，這就是我們之前說的公式的由來

116
00:06:30,080 --> 00:06:35,150
說我們是對 1/(1-beta) 天做平均

117
00:06:35,150 --> 00:06:39,915
在這裡 epsilon 相當於 1-beta。

118
00:06:39,915 --> 00:06:42,350
這告訴了你，在某個定值以上，

119
00:06:42,350 --> 00:06:45,148
大概有多少日子的氣溫，是你認為足以當作平均的。

120
00:06:45,148 --> 00:06:48,175
不過呢這只是大略地描述其思路

121
00:06:48,175 --> 00:06:51,290
並不是正式的數學說明。

122
00:06:51,290 --> 00:06:54,290
最後，來談實際上你要怎麼實作

123
00:06:54,290 --> 00:06:57,760
還記得我們從 V_0 為 0 開始

124
00:06:57,760 --> 00:06:59,570
然後計算第一天的 V_1

125
00:06:59,570 --> 00:07:01,605
V_2, 等等等

126
00:07:01,605 --> 00:07:02,630
那麼，為了解釋演算法，

127
00:07:02,630 --> 00:07:05,990
把 V_0, V_1, V_2

128
00:07:05,990 --> 00:07:09,480
寫成不同的變數，解釋比較方便。

129
00:07:09,480 --> 00:07:11,835
不過實際寫程式的時候

130
00:07:11,835 --> 00:07:15,774
你會這麼做：你把變數 V 初始成 0，

131
00:07:15,774 --> 00:07:17,555
然後在第一天

132
00:07:17,555 --> 00:07:21,105
你會定義 V 為

133
00:07:21,105 --> 00:07:25,405
beta * V + (1-beta) * theta_1

134
00:07:25,405 --> 00:07:27,780
然後隔天，你更新 V 的值

135
00:07:27,780 --> 00:07:31,805
變成 beta * V

136
00:07:31,805 --> 00:07:33,820
+ (1-beta)

137
00:07:33,820 --> 00:07:35,985
theta_2, 依此類推

138
00:07:35,985 --> 00:07:41,282
有時候標示上會用 V 下標 theta 來表示

139
00:07:41,282 --> 00:07:47,115
V 在計算參數 theta 的指數加權平均

140
00:07:47,115 --> 00:07:49,690
那麼，我用 for 迴圈的方式把這個再寫一次

141
00:07:49,690 --> 00:07:52,095
你設 V_theta 為 0

142
00:07:52,095 --> 00:07:55,715
然後每天重複做

143
00:07:55,715 --> 00:08:02,314
拿下一個 theta_t，然後

144
00:08:02,314 --> 00:08:05,140
更新 V_theta 為

145
00:08:05,140 --> 00:08:07,210
beta 乘以舊的 V_theta

146
00:08:07,210 --> 00:08:08,750
加 (1-beta)

147
00:08:08,750 --> 00:08:12,045
乘以這一次的 theta_t。

148
00:08:12,045 --> 00:08:15,440
所以這種指數加權平均算法的優點

149
00:08:15,440 --> 00:08:17,140
在於他佔非常少的記憶體

150
00:08:17,140 --> 00:08:21,175
你只要儲存這單一個數字在記憶體內

151
00:08:21,175 --> 00:08:26,965
然後你一直用這式子算出最新的值，然後覆蓋之

152
00:08:26,965 --> 00:08:29,590
因為「效率」這一個理由

153
00:08:29,590 --> 00:08:33,340
你只需要一行程式碼

154
00:08:33,340 --> 00:08:34,690
而且記憶體

155
00:08:34,690 --> 00:08:38,320
只需要記一個數字，就可以算出指數加權平均

156
00:08:38,320 --> 00:08:40,195
這其實不是最佳

157
00:08:40,195 --> 00:08:42,805
最準的算法來計算平均

158
00:08:42,805 --> 00:08:44,920
如果你以移動範圍 (moving window) 來計算

159
00:08:44,920 --> 00:08:47,770
也就是你明確地算出過去十天的總和

160
00:08:47,770 --> 00:08:51,550
或過去五十天氣溫的總和，然後除以10或50

161
00:08:51,550 --> 00:08:53,320
這通常會是個較好的估計

162
00:08:53,320 --> 00:08:55,265
但其缺點是

163
00:08:55,265 --> 00:08:57,550
必須要一直記得最近的氣溫

164
00:08:57,550 --> 00:09:00,190
和近十天的總和，這花更多的記憶體

165
00:09:00,190 --> 00:09:03,990
實作起來更複雜，計算也比較費力

166
00:09:03,990 --> 00:09:07,885
我們會在後面的影片看到幾個例子，所以那些

167
00:09:07,885 --> 00:09:12,130
要算很多變數的平均的情況

168
00:09:12,130 --> 00:09:15,625
利用這個會很有效率 — 從計算

169
00:09:15,625 --> 00:09:19,840
和記憶體來看都是 — 所以在機器學習中很常用到

170
00:09:19,840 --> 00:09:24,280
更不用說這只需要一行程式，也算是另一個優點。

171
00:09:24,280 --> 00:09:28,570
所以現在你已經知道要怎麼寫出指數加權平均了

172
00:09:28,570 --> 00:09:30,160
還有一個技術上的細節，

173
00:09:30,160 --> 00:09:32,965
值得一聽，叫偏差矯正 (bias correction)

174
00:09:32,965 --> 00:09:35,365
我們下部影片會看到。然後接下來

175
00:09:35,365 --> 00:09:37,420
你會用這整個技巧來建構

176
00:09:37,420 --> 00:09:41,450
比正常的梯度下降法還要更厲害的最佳化演算法