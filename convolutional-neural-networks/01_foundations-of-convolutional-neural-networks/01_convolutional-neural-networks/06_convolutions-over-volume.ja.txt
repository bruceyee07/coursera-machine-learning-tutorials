これまで どのように２D画像で畳み込みが働くのを見てきた ここからは畳み込みを ２D画像だけでなく 3次元ボリュームにも実装していく方法を学習しよう 例から始めよう 特徴検出を行うが 単なるグレースケール画像で ではなく RGB画像で そうすると RGB画像は 6 x 6 画像の代わりに 6 x 6 x 3 になるだろう この３は ３つのカラーチャンネルだ これは 6 x 6 画像を 3つ重ねたものと 捉えることができる この画像で エッジや 他の特徴を 検出するため これを 畳み込むわけだが 前に使ったような 3 x 3 フィルターではなく 3Dフィルターを使う それは 3 x 3 x 3 フィルターとなる このフィルター自身 ３つの層を持っている 赤 緑 青 のチャンネルだ それじゃ これらに名前を付けよう この最初の６は 画像の "高さ" これは "幅" そして この３は "チャンネル数" そして フィルターにも "高さ" "幅" "チャンネル数" がある そして 画像のチャンネル数は フィルターのチャンネル数と合わなくてはならない つまり この２つの数は同じでなくてはならない 次のスライドでは この畳み込み処理が 実際にどのように働くのかを見るけど 出力は 4 x 4 画像になる これは 4 x 4 x 1 になることに注意してね 最後は ３ じゃない これが どのように働くのかの詳細に行くけど
もっと素敵な画像を使おう これが 6 x 6 x 3 画像 これが 3 x 3 x 3 フィルター そして この最後の番号が チャンネル数で 画像とフィルターとで 一致している この 3 x 3 フィルターを描くのを簡略化するため 行列を重ねるのではなく このような ３次元の立方体で描くよ では この畳み込み処理の出力を計算する やることは 3 x 3 x 3 フィルターを取り 左上のこの場所におく 3 x 3 x 3 フィルターには27個の数字がある 27個のパラメーターを持つ 3次元の立方体だ それから この27個の数字それぞれを 画像の 対応する赤緑青のチャンネルの数字に かけ合わせる 赤チャンネルから最初の9つの数を取り その下の緑チャンネルから３つ(訳注: ９つの言い間違いであろう) その下の青チャンネルから３つ(訳注: ９つの言い間違いであろう) そして 左に示した黄色の立方体が覆っている27個の数と それぞれ 掛け算する そして これらの数字を足し合わせて 出力の最初の数字を得る そして 次の出力を計算するのに このの立方体を1つずらし そして 再び 27回 掛け算をし 27個の数を足し合わせる これで 二つ目の出力を得る 同じことを次にも行い 次の位置にも行い 3番目の出力を得 次も続け 4番目を得る それから 行を1つ下げ 次のを行い そして次 次 以下同様 分かるでしょ 最後にくるまで ここが最後の出力を得る位置となる さて ここで行ったことが 何をもたらすのか？ 例を挙げよう このフィルターは 3 x 3 x 3 だ よって 画像の赤チャンネルのエッジを検出したければ 最初のフィルターを いつも通りに 1 1 1, ..., -1 -1 -1 として 緑のチャンネルはすべて 0 にし 青のチャンネルもすべて 0 にする そして これら３つを積み重ねて 3 x 3 x 3 フィルターにすれば そうしたら これは 赤チャンネルにおいてのみ エッジ検出するフィルターになる 逆に 垂直エッジの色が 何でもいいのであれば こんなフィルターになるだろう 1 1 1, ..., -1 -1 -1 全てのチャンネルで この２番目の例では こんなパラメータをセットして エッジ検出器を得た 3 x 3 x 3 のエッジ検出器を それは どんな色のエッジも検出する そして これらのパラメータの異なる選択により この 3 x 3 x 3 フィルターから 異なる特徴検出器を得ることができる なお コンピュータ ビジョンの慣例では 入力が ある高さ ある幅 あるチャンネル数 の時 フィルターは 異なる高さ 異なる幅にし得るが チャンネル数は同じにする 理論的には 赤チャンネルだけを見るフィルターというのも可能だが もしくは 緑チャンネルだけ 青チャンネルだけ を見るフィルターというのも また言うけど 気付いているだろうけど ボリュームを畳み込む 6 x 6 x 3 を 3 x 3 x 3 で畳み込むと 4 x 4 の２D出力が得られる これで ボリュームを畳み込む方法を理解したでしょう 最後に1つ 畳み込みニューラルネットワークを構築するに当たって 重要な考えがある それは もし 垂直エッジの検出だけをしたいのでは無い場合 どうするか？ というものだ 垂直エッジと水平エッジを検出したい場合 どうするか？ もし 45°エッジと70°エッジも 検出したい場合は？ 言い換えれば 同時に複数のフィルターを使いたい場合 どうするか？ ここに 前のスライドから持ってきた絵がある 6 x 6 x 3 を 3 x 3 x 3 で畳み込んで 4 x 4 を得た そして これは垂直エッジ検出器かもしれないし 他の特徴検出器かもしれない では ２番目のフィルターをこのオレンジ色で示そう これは 水平エッジ検出器かもしれない 最初のフィルターで畳み込むと 最初の 4 x 4 出力を得る ２番目のフィルターで畳み込むと 別の 4 x 4 出力を得る 我々ができるのは この２つの 4 x 4 出力を取り 最初のを前に置き ２番目のフィルターの出力を ここに描く このように 後ろに置こう こんな風に ２つを一緒に積み重ねると 4 x 4 x 2 出力ボリュームを得る でしょ？ そして このボリュームは ここに描くように 箱と考えることができる こんな感じになる これは 4 x 4 x 2 出力ボリュームだ これは 6 x 6 x 3 画像を ２つの異なる 3 x 3 x 3 で畳み込んだ結果だ ２つの 4 x 4 出力を得て 積み重ね 4 x 4 x 2 ボリュームを作った そして この２つは ２つの異なるフィルターを使ったことから来ている それでは 次元数についてまとめよう n x n x チャンネル数 の入力画像があり 例えば 6 x 6 x 3 ここで 下付き文字 C の n はチャンネル数だ そして それを f x f x (同じ値となる下付き文字 C の n) で 畳み込む これは 3 x 3 x 3 そして 慣例では これとこれは 同じ数になる よって 得られるのは n - f + 1  x  n - f + 1  x  nC' これは 実は 次の層のnCだ とにかく これが 使うフィルターの数だ そうして この例では これは 4 x 4 x 2 となる それから これは ストライド１でパディング無しを仮定して書いた でも 異なるストライドやパディングを使うなら この n - f + 1 は 前のビデオで見たのと 同じ影響を受ける さぁ ボリュームを畳み込むという考えは とても強力だと分かった その一つは ３チャンネルあるRGB画像を直接処理できることだ だが より重要なのは 垂直や水平等の２つの特徴 もしくは10個の もしくは128個の もしくは数百個の異なる特徴を検出できることだ そして 出力は 検出するフィルター数と同じチャンネル数となる 記法についての注意をする 私は 文献では この最後の次元を チャンネル数と呼んできた これは ３Dボリュームの深さと呼ばれることもある チャンネルも深さも 共に 文献で使われる しかし 深さは より混乱させ易い なぜなら ニューラルネットワークの深さについて話す場合も良くあるからだ それで 私は このビデオではチャンネルという用語を使う このフィルターの３番目の次元を言うのに さぁ これで ボリューム畳み込みの実装方法が分かっただろう あなたは 畳み込みニューラルネットワーク層を実装する準備が整った 次のビデオで それをどのように行うか見よう