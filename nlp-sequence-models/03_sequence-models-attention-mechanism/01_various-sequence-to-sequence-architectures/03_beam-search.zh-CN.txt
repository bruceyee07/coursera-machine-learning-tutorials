在本次视频中，你将会学习集束搜索算法 上个视频中 你知道当输入一个法语句子给机器是如何翻译的 你不想随机输出一个英文翻译 你想要输出最佳且最贴合英语语言的翻译 对于语音识别来说也是相同的，对于一段语音音频 你不想给这个音频随机输出一些文字 你想要最佳的输出结果 或许说，输出最佳的对应文字 波束搜索是最广泛使用的算法。 在这个视频中，你将会学习如何使用集束搜索 让我们先尝试在之前的法语例子上应用集束搜索 "Jane, visite l'Afrique en Septembre". 希望可以被翻译成， "简在9月访问非洲。” 集束搜索第一件要做的事情就是尝试 挑出对应的第一个英语词汇 以供输出 所以我在这里列出了, 例如,1万个词汇。 稍微将问题简化一下 我会忽略大小写 所以我只是将所有单词以小写形式列出 在集束搜索的第一步, 我用了这部分编码示为绿色、解码示为紫色的网络 来计算第一个单词的概率 即，给定法语单词x，对应英语单词为y的可能性。 给定法语输入句x 相对于贪心法搜索会
只找到一个最可能的单词然后继续下一个， 集束搜索会考虑多个可能的选择。 集束搜索有一个参数B， 代表集束宽度， 在这里我们把它设为3. 表示集束搜索每次会不仅仅考虑1个， 而是3个可能的选择 举例来说，计算 对应第一个单词的候选答案的不同概率时， 算法觉得候选单词“in”, “Jane”和“September”是 3个最可能的英语输出。 集束搜索算法会将这3个候选答案都存在 内存中以便都进行尝试。 如果集束宽度B被设成其它值， 比如10， 那我们会保留不仅仅3个而是10个 最可能的第一个法语单词备选答案。 为了进行集束搜索的第一步， 你需要做的是把这个法语句子输入到 这个编码网络，以及解码网络的第一步骤 这是在10,000个几率中softmax的输出 然后将这10,000个可能的输出 中的前3名存在内存中。 让我们进入集束搜索的第二步。 在挑选了in，jane和september作为三个最可能的第一个词的选择, 集束搜索现在会做的是, 这三种选择中的每一项都考虑第二个词应该是什么, 所以在“in”之后可能是“a”，或者是“araon“ 我这里把词库里的词列举一下 或者还可能是“September" 或者"Visit" 直到列表的最后一个词“Zulu" 为了评估每个第二个候选词的概率 算法会用这个神经网络，网络中绿色的是编码器 而解码器要决定“in”之后的词是什么 还记得解码器首先输出y^1 我将把y-hat1的值设成“in“作为解码器的输出
并反馈到网络的下一部分 因为“in”已经被选中了 解码器需要在“in”被选中之后 找出下一个词 接着解码器输入下一个可能的词y^2 这样在指定了y^1 也就是网络的输入是“in”之后 这部分的网络可以用来评估 在法语单词第二个词给定的情况下 给定的情况下 第二个翻译单词是“in”的概率 注意，我们关注的集束算法的第二步 就是找到最佳的第一个词和第二个词的组合为最佳选择 而不仅仅是每个词为 最佳选择 根据条件概率 概率可以表示为第一个单词的概率 乘第二个单词的概率 概率可以从网络的这部分中得来 对于选中的“in”，“Jane”和“September”, 我们将它们各自的概率与第二个选中词的概率相乘 就可以得到各自与第二个单词一起出现的概率 现在我们知道了在知道第一个词是“in”的时候 如何评估第二个词的概率 对于“Jane”也是一样 这个句子可能是“Jane a”, "Jane Araon", 或者是“Jane is” “Jane visits”等等 你可以将这部分网络的 y^1，让我在这里也画一下，你会在这里画一些线 设置成“Jane” 当第一个词被设置为‘jane' 这样解码器网络 可以告诉你第二个单词的概率是什么。 给定第一个词是 "jane"。 然后和上面一样, 你可以乘以 P（Y1）以获得 这10000种可作为第二个词选择的y1和y2概率 然后对‘september'做同样的事情 从 ‘a‘ 到‘zulu’使用这个网络片断。 这也是为了看看如果第一个词是‘september’ 第二个单词最有可能的选择是什么。 所以对于集束搜索的第二步, 因为我们 继续使用集束宽度3而且因为有 10000个词汇，你会考虑3乘以 10000是30000种可能性，因为这里有10000 这里有10000，这里有10000 集束宽度乘以词汇里的词的数量，并且 你评估这所有的30000种选择 根据可能的前两个词然后挑出最可能的三种可能 因此, 随着削减, 这30000种可能性被降低为3种可能 集束宽度再次四舍五入，那么我们说30000种选择, 最可能的是‘in September‘和‘Jane is‘ 和·‘jane visit‘。
不好意思这里有点乱，但是这些是30000种选择里 可能性最高的三种。然后集束搜索会记住这些 然后继续下一步 所以注意一件事, 如果集束搜索决定 最可能的前两个词是‘ in September,‘ 或者‘Jane is‘，或者’jane visits‘ 那么这意味着现在它将会拒绝‘september'作为 第一个英文翻译输出词的候选 所以我们现在只有两种选择，但是我们仍然有集束宽度3 来保证y1的三种配对可能 在进行第三部集束搜索之前 注意到,由于集束宽度等于三, 每个步骤你实例化网络的三个副本 来评估这些部分句子片段和输出 由于集束宽度是3你有 三个第一个词不同的网络的副本 但是这三个副本可以被有效的用来 评估第二个单词的所有30000种选择。 不要实例化网络的30000个副本或网络的三个副本来 非常迅速地评估这个softmax的为Y2的所有10000种可能。 让我们快速地说明集束搜索的下一步。 我们说过最有可能的前两个词是
‘in september‘和’jane is‘, 和‘jane visits‘， 并且对于这每一对词 我们应该以这种形式保存在计算机中： 给定输入的法语句子x，y1和y2的概率 与之前相似, 我们现在想要考虑第三个词是什么。 那么是‘in September a‘？ ‘In September Aaron?‘ 一直下去到 ‘September Zulu ‘来估量第3个词的可能的选择 你使用这个网络碎片来确定 第一个词是‘in‘第二个词是‘september’。 这个网络碎片使你能估计 给定输入的法语句子x， 和前两个词是英文输出‘in september‘，第三个词的概率 然后你对第二个片段做同样的事情。 就像这样。 对‘jane visit‘也是 同样的， 集束搜索将再次选择 在9月的可能性最高的三种可能。 ‘jane‘是一个可能的结果,
或者‘jane'要访问是可能的，或者jane访问非洲 对于前3个词是可能的，然后它继续 开始集束搜索的第4步 再加一个词然后继续 这个过程的输出结果将会是 每一次加一个词，集束搜索会决定每次加哪个词 ‘Jane visits Africa in September ‘被句尾符号终止 是比较常见的。 他们会发现这是一个可能的输出英语句子 你将会在这周课后练习中独立进行集束搜索时 看到更多的细节 当三束被搜索时同时考虑三种可能性。 请注意到如果集束宽度被设置为1, 因为这里只有一个 那么这基本上成为 我们在上一个视频里讨论过的贪婪搜索算法, 但通过考虑 多种可能性比如说3种10种或其他数字 在同一时间，集束搜索通常会 找到一个比贪婪搜索更好的输出语句 你现在已经看到了集束搜索如何工作,但其实有 来自于合作伙伴的一些额外的建议和技巧 可以帮助你使集束搜索工作得更好。 让我们在下一个视频来看看。